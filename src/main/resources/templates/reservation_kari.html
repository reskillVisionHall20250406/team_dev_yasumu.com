<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="/css/calendar.css">
	<title>宿予約 - チェックイン日選択</title>
</head>

<body>
	<div class="container">
		<header th:replace="header2"></header>
		<main>
			<div class="calendar-section">
				<h2>予約日を選択してください</h2>
				<div class="month-selector">
					<button onclick="changeMonth(-1)">前の月</button>
					<span id="month-year"></span>
					<button onclick="changeMonth(1)">次の月</button>
				</div>
				<table>
					<thead>
						<tr>
							<th>日</th>
							<th>月</th>
							<th>火</th>
							<th>水</th>
							<th>木</th>
							<th>金</th>
							<th>土</th>
						</tr>
					</thead>
					<tbody id="calendar"></tbody>
				</table>
			</div>
			<div class="confirm-area">
				<form action="/reservation/days" method="post">
				  <input type="hidden" name="days" id="hidden-days">
				  <p>選択された日付: <span id="selected-dates">未選択</span></p>
				  <button type="submit">この日程で予約する</button>
				</form>

			</div>
	</div>
	</main>
	<script>
		const today = new Date();
		today.setHours(0, 0, 0, 0);


		let current = new Date(today);
		let selected = null;
		let selectedBtn = null;

		const holidays = [
			"2025-01-01", "2025-01-13", "2025-02-11", "2025-02-23",
			"2025-03-20", "2025-04-29", "2025-05-03", "2025-05-04", "2025-05-05",
			"2025-07-21", "2025-08-11", "2025-09-15", "2025-09-23",
			"2025-10-14", "2025-11-03", "2025-11-23", "2025-12-23"
		];


		const reservedDates = [
			// ここに予約済みの日付を "YYYY-MM-DD" 形式で追加
			"2025-06-18", "2025-07-10", "2025-07-15"
		];

		function updateCalendar() {
			const year = current.getFullYear();
			const month = current.getMonth();
			document.getElementById("month-year").textContent = `${year}年 ${month + 1}月`;
			const calendarBody = document.getElementById("calendar");
			calendarBody.innerHTML = "";
			const firstDay = new Date(year, month, 1);
			const lastDay = new Date(year, month + 1, 0);
			let row = document.createElement("tr");


			for (let i = 0; i < firstDay.getDay(); i++) {
				row.appendChild(document.createElement("td"));
			}


			for (let d = 1; d <= lastDay.getDate(); d++) {
				if (row.children.length === 7) {
					calendarBody.appendChild(row);
					row = document.createElement("tr");
				}
				const cell = document.createElement("td");
				const btn = document.createElement("button");
				btn.className = "date-btn";
				btn.textContent = d;


				const date = new Date(year, month, d);
				date.setHours(0, 0, 0, 0);


				const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;


				let isDisabled = date < today || reservedDates.includes(dateStr);


				if (isDisabled) {
					btn.disabled = true;
					btn.title = reservedDates.includes(dateStr) ? "予約済み" : "選択不可";
				} else {
					btn.onclick = () => selectDate(date, btn);
				}


				if (holidays.includes(dateStr)) {
					btn.classList.add("holiday");
				} else if (date.getDay() === 0) {
					btn.classList.add("sunday");
				} else if (date.getDay() === 6) {
					btn.classList.add("saturday");
				}


				cell.appendChild(btn);
				row.appendChild(cell);
			}


			while (row.children.length < 7) {
				row.appendChild(document.createElement("td"));
			}
			calendarBody.appendChild(row);
		}


		function selectDate(date, btn) {
			if (selectedBtn) selectedBtn.classList.remove("selected");
			selected = date;
			selectedBtn = btn;
			btn.classList.add("selected");
			document.getElementById("selected-dates").textContent = `${formatDate(date)}`;
			const dateStr = formatDate(date);
			 document.getElementById("selected-dates").textContent = dateStr;
			 document.getElementById("hidden-days").value = dateStr;
		}


		function formatDate(date) {
			if (!date) return "未選択";
			return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
		}


		function changeMonth(diff) {
			current.setMonth(current.getMonth() + diff);
			updateCalendar();

		}


		function confirmDate() {
		  if (!selected) {
		    alert("チェックイン日を選択してください。");
		    return false;
		  }
		  return confirm("この日程で予約しますか？");
		}


		updateCalendar();
	</script>
</body>

</html>